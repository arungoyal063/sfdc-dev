<apex:page standardController="RFP__c" extensions="OpptyLineItemController">
    <script type="text/javascript">
        
        //Function is used to get splash status bar when server side call is going on
        function startSplash() {
            var divObj = document.getElementById('splashDiv');
            //var msgSplash =document.getElementById('waitMsg');
            divObj.style.display='table-cell';
               
        }
            
        //Function will make the splash status to be stopped.    
        function endSplash() {            
            document.getElementById('splashDiv').style.display='none';
        }
         
    </script>
    <apex:sectionHeader title="Select Products" subtitle="Opportunity - {!opportunity.Name}"/>
    <apex:form id="formId">
        <apex:outputPanel id="errorPanel" >
            <apex:pageMessages />
        </apex:outputPanel>
        <apex:actionStatus id="splashStatus" onstart="startSplash()" onstop="endSplash()"/>
        <apex:pageblock id="pb" title="Opportunity Line Item">
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton value="Submit" action="{!submit}"/>
            </apex:pageBlockButtons>
            <!-- <table width="100%" >
                <tr>
                    
                    <td width="25%" align="right" style="padding-right: 30px;">
                        <apex:outputLabel value="Price Book Name" />
                    </td>
                    <td width="25%" >
                        <apex:inputField value="{!olineItem.PricebookEntryId}" />
                    </td>
                    
                    <td width="5%" align="right" style="padding-right: 30px;">
                        <apex:outputLabel value="Opportunity Name" />
                    </td>
                    <td width="25%" >
                        <apex:outputLabel value="{!opportunity.Name}" />
                    </td>
                </tr>
            </table> -->
            <div align="right" style="width: 100%">
                <apex:commandButton value="Add Product" action="{!addRow}" reRender="pbTable, errorPanel"  status="splashStatus"/>              
            </div>
            <apex:pageBlockTable id="pbTable" value="{!lineItemList}" var="li" >
                <apex:column headerValue="Product Category" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Product Category" />
                    </apex:facet>
                    <apex:selectList value="{!li.prodName}" size="1">
                        <apex:selectOptions value="{!li.prodOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchStyleDesc}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Style Desc" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Style Description" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Style_Description__c}" size="1">
                        <apex:selectOptions value="{!li.styleDescOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchBk}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="BK" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="BK" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Bk__c}" size="1">
                        <apex:selectOptions value="{!li.bkOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchSize}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Size" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Size" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Size__c}" size="1">
                        <apex:selectOptions value="{!li.sizeOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchColorDesc}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Color Desc" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Color Description" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Color_Description__c}" size="1">
                        <apex:selectOptions value="{!li.colorDescOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchUOM}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <!-- 
                <apex:column headerValue="Sidemark" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Sidemark" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.Sidemark__c}" style="width:60px;"/>
                </apex:column>
                 -->
                <apex:column headerValue="Quantity" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Unit of Measure" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Unit_of_Measure__c}" size="1">
                        <apex:selectOptions value="{!li.unitMeasureOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchProductCode}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <!-- 
                <apex:column headerValue="List Price" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="List Price" />
                    </apex:facet>
                    <apex:outputText value="${!li.listPrice}" />
                </apex:column>
                 -->
                <apex:column headerValue="Selling Price" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Selling Price" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.UnitPrice}"  style="width:60px;"/>
                </apex:column>
                <apex:column headerValue="Quantity" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Quantity" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.Quantity}" required="false" style="width:60px;"/>
                </apex:column>
                <apex:column headerValue="Action" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Action" />
                    </apex:facet>
                    <apex:commandButton value="Delete" action="{!deleteRow}" reRender="pbTable">
                        <apex:param value="{!li.rowIndex}" name="rIndex" />
                    </apex:commandButton>
                </apex:column>
                <apex:column headerValue="Product Code" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Product Code" />
                    </apex:facet>
                    <apex:outputLink value="/{!li.productId}" id="pId">{!li.pCode}</apex:outputLink>
                </apex:column>
            </apex:pageBlockTable>
        </apex:pageblock>
    </apex:form>
    <div id="splashDiv" style="display:none; position:absolute; left:50%; top:50%; z-index: 100;"><img src="/img/loading.gif" /></div>
</apex:page>