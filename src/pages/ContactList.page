<apex:page standardController="Contact" extensions="ContactListExtension" showHeader="false" sidebar="false">
<apex:sectionHeader title="Select Multiple Recipients"/>
<apex:outputPanel id="errMsg">
    <apex:pagemessages />
</apex:outputPanel>
<apex:form >
<apex:pageBlock id="pgBlock">
    <apex:outputText >Please enter a keyword to search for accounts and Click Search Contacts. </apex:outputText>
    <apex:pageBlockSection columns="4">
        <apex:inputText value="{!keyword}" label="Account" title="Keyword"/>
            <apex:commandButton value="Search Contacts" action="{!SearchContacts2}" reRender="ContactList, errMsg" status="statusMsg"/>
        <apex:outputText ></apex:outputText>
        <apex:outputText ></apex:outputText>
    </apex:pageBlockSection>
</apex:pageblock>
<apex:pageblock title="Search Results">
    <apex:pageBlockSection columns="1">
        <apex:pageBlockTable value="{!wrapList}" var="w" width="100%" columns="6" id="ContactList">
            <apex:column >
                <apex:facet name="header"><input type="checkbox" id="selectAll" onclick="selectAllCheckbox()"/></apex:facet>
                <apex:inputCheckbox value="{!w.check}" id="check" onclick="validateSelectAll(this.id)"/>
            </apex:column>
            <apex:column headerValue="Name">
                <apex:outputText value="{!w.con.FirstName} {!w.con.LastName}" />
            </apex:column>
            <apex:column headerValue="Title">
                <apex:outputText value="{!w.con.Title}"/>
            </apex:column>
            <apex:column headerValue="Email">
                <apex:outputText value="{!w.con.Email}"/>
            </apex:column>
            <apex:column headerValue="Phone">
                <apex:outputText value="{!w.con.Phone}"/>
            </apex:column>
            <apex:column headerValue="Account">
                <apex:outputText value="{!w.con.Account.Name}"/>
            </apex:column>
        </apex:pageBlockTable>
    </apex:pageBlockSection>
    <apex:pageBlockButtons >
    <div id="enableDiv" style="display:block;"><apex:commandButton value="Add Selected" action="{!addSelected}" reRender="pgBlock2" oncomplete="enableButton()" onclick="disableButton()"/>
    </div>
    <div id="disableDiv" style="display:none;"><apex:commandButton value="Send Email" rerender="dummy" disabled="true"/>
    <apex:commandButton value="Close Window" rerender="dummy" disabled="true"/>
    </div>
    </apex:pageBlockButtons>
    <div id="statusMsg" style="display:none;color:blue;"><b>Please wait....</b></div>
</apex:pageBlock>
<apex:pageBlock id="pgBlock2" title="Selected Contacts">
    <apex:pageBlockSection columns="1">
        <apex:pageBlockTable value="{!wrapListSendEmail}" var="w" width="100%" id="ContactListFinal">
            <apex:column headerValue="Name">
                <apex:outputText value="{!w.con.FirstName} {!w.con.LastName}" />
            </apex:column>
            <apex:column headerValue="Title">
                <apex:outputText value="{!w.con.Title}"/>
            </apex:column>
            <apex:column headerValue="Email">
                <apex:outputText value="{!w.con.Email}"/>
            </apex:column>
            <apex:column headerValue="Phone">
                <apex:outputText value="{!w.con.Phone}"/>
            </apex:column>
            <apex:column headerValue="Account">
                <apex:outputText value="{!w.con.Account.Name}"/>
            </apex:column>
        </apex:pageBlockTable>
    </apex:pageBlockSection>
    <apex:pageblockButtons >
        <div id="enableDiv" style="display:block;">
            <apex:commandButton value="Send Email" action="{!sendEmail2}" reRender="pgBlock,errMsg" oncomplete="enableButton()" onclick="disableButton()"/>
            <apex:commandButton value="Close Window" rerender="dummy" onclick="closeWindow()"/>
            <apex:commandButton value="Reset" action="{!resetEmailList}" reRender="pgBlock2"/>
        </div>
        <div id="disableDiv" style="display:none;"><apex:commandButton value="Send Email" rerender="dummy" disabled="true"/>
        </div>
    </apex:pageblockButtons>
</apex:pageBlock>
</apex:form>
<script>
var contactSelected =0;
function closeWindow()
{
    window.close();
}
function disableButton()
{
    if(contactSelected > 0)
    {
        document.getElementById("enableDiv").style.display = "none";
        document.getElementById("disableDiv").style.display = "block";
        document.getElementById("statusMsg").style.display = "block";
    }
    else
    {
        //alert("Please select atleast one Contact before proceeding.");
    }
}
function enableButton() {
    contactSelected = 0;
    document.getElementById("enableDiv").style.display = "block";
    document.getElementById("disableDiv").style.display = "none";
    document.getElementById("statusMsg").style.display = "none";
}
function selectAllCheckbox()
{
    var obj = document.getElementById("selectAll").checked; 
    contactSelected = 0;
    var allObj = document.getElementsByTagName("input");
    for (var i = 0; i < allObj.length; i++) 
    {   
        if(allObj[i].type == "checkbox")
        {
           allObj[i].checked = obj;
           if(obj == true) contactSelected = contactSelected + 1;
        }
    }
}
///If selectAll is checked and any checkbox is unchecked-selectAll should become uncheck
function validateSelectAll(objId)
{
    var obj = document.getElementById(objId).checked;
    if(document.getElementById("selectAll").checked == true && obj == false )
    {
        document.getElementById("selectAll").checked = obj; 
    }
    if(obj == true )
    {
        contactSelected  = contactSelected + 1;
    }
}
</script>
</apex:page>