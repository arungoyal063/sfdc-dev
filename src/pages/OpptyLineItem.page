<apex:page standardController="Opportunity" extensions="OpptyLineItemController" sidebar="false">
    <style>
    .ajax-loader {
        background-color: rgb(71,71,71);
        opacity:0.7;
        filter:alpha(opacity=70);
        background-image:url('/img/loading.gif');
        background-position: center center;
        background-repeat: no-repeat;
        height: 100%;
        left: 0;
        position: fixed;
        text-align: center;
        top: 0;
        width: 100%;
        z-index: 1;
    }
    </style>
    <apex:sectionHeader title="Select Products" subtitle="Opportunity - {!opportunity.Name}"/>
    <apex:form id="formId">
        <apex:outputPanel id="errorPanel" >
            <apex:pageMessages />
        </apex:outputPanel>        
        <!--apex:actionStatus id="splashStatus" onstart="startSplash()" onstop="endSplash()"/-->
        <apex:actionStatus id="splashStatus" startStyleClass="ajax-loader"/>
        
        <apex:pageblock id="pb1" title="Opportunity Line Item" >
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton value="Submit" action="{!submit}"/>
            </apex:pageBlockButtons>
            <!-- <table width="100%" >
                <tr>
                    
                    <td width="25%" align="right" style="padding-right: 30px;">
                        <apex:outputLabel value="Price Book Name" />
                    </td>
                    <td width="25%" >
                        <apex:inputField value="{!olineItem.PricebookEntryId}" />
                    </td>
                    
                    <td width="5%" align="right" style="padding-right: 30px;">
                        <apex:outputLabel value="Opportunity Name" />
                    </td>
                    <td width="25%" >
                        <apex:outputLabel value="{!opportunity.Name}" />
                    </td>
                </tr>
            </table> -->
            <div align="right">
                <apex:commandButton value="Add Product" action="{!addRow}" reRender="pbTable, errorPanel"  status="splashStatus"/>
            </div>
            <apex:pageBlockTable id="pbTable" value="{!lineItemList}" var="li">
                <apex:column headerValue="Product Category">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Product Category" />
                    </apex:facet>
                    <apex:selectList value="{!li.prodName}" size="1">
                        <apex:selectOptions value="{!li.prodOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchStyleDesc}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Style Desc">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Style Description" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Style_Description__c}" size="1">
                        <apex:selectOptions value="{!li.styleDescOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchBk}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="BK" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="BK" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Bk__c}" size="1">
                        <apex:selectOptions value="{!li.bkOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchSize}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Size" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Size" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Size__c}" size="1">
                        <apex:selectOptions value="{!li.sizeOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchColorDesc}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <apex:column headerValue="Color Desc" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Color Description" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Color_Description__c}" size="1">
                        <apex:selectOptions value="{!li.colorDescOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchUOM}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                
                
                <!-- 
                <apex:column headerValue="Sidemark" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Sidemark" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.Sidemark__c}" style="width:60px;"/>
                </apex:column>
                 -->
                <apex:column headerValue="Quantity" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Unit of Measure" />
                    </apex:facet>
                    <apex:selectList value="{!li.oli.Unit_of_Measure__c}" size="1">
                        <apex:selectOptions value="{!li.unitMeasureOptions}" />
                        <apex:actionSupport event="onchange" action="{!fetchProductCode}" reRender="pbTable,errorPanel" status="splashStatus">
                            <apex:param value="{!li.rowIndex}" name="rIndex" />
                        </apex:actionSupport>
                    </apex:selectList>
                </apex:column>
                <!-- 
                <apex:column headerValue="List Price" style="width:150px;">
                    <apex:facet name="header"> 
                        <apex:outputLabel value="List Price" />
                    </apex:facet>
                    <apex:outputText value="${!li.listPrice}" />
                </apex:column>
                 -->
                <apex:column headerValue="Selling Price" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Selling Price" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.UnitPrice}" />
                </apex:column>
                <apex:column headerValue="Quantity" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Quantity" />
                    </apex:facet>
                    <apex:inputField value="{!li.oli.Quantity}" required="false"/>
                </apex:column>
                <apex:column headerValue="Action" >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Action" />
                    </apex:facet>
                    <apex:commandButton value="Delete" action="{!deleteRow}" reRender="pbTable">
                        <apex:param value="{!li.rowIndex}" name="rIndex" />
                    </apex:commandButton>
                </apex:column>
                <apex:column headerValue="Product Code"  >
                    <apex:facet name="header"> 
                        <apex:outputLabel value="Product Code" />
                    </apex:facet>
                    <apex:outputLink value="/{!li.productId}" id="pId">{!li.pCode}</apex:outputLink>
                </apex:column>
            </apex:pageBlockTable>
        </apex:pageblock>
    </apex:form>
    
</apex:page>